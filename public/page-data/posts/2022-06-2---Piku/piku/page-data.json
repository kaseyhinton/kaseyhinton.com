{"componentChunkName":"component---src-templates-post-template-post-template-tsx","path":"/posts/2022-06-2---Piku/piku","result":{"data":{"markdownRemark":{"id":"de587312-58c1-5bc1-b02e-d60d8c02d93b","html":"<h1 id=\"piku-paas-setup\" style=\"position:relative;\"><a href=\"#piku-paas-setup\" aria-label=\"piku paas setup permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Piku PaaS Setup</h1>\n<h3 id=\"helpful-links\" style=\"position:relative;\"><a href=\"#helpful-links\" aria-label=\"helpful links permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Helpful Links</h3>\n<p><a href=\"https://github.com/piku/piku\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Piku Github Page</a></p>\n<p><a href=\"https://www.youtube.com/watch?v=ec-GoDukHWk\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Youtube Video by Chris McCormick</a></p>\n<h3 id=\"configure-new-vps\" style=\"position:relative;\"><a href=\"#configure-new-vps\" aria-label=\"configure new vps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Configure New VPS</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">ssh</span> root@myserverip\r\n<span class=\"token function\">curl</span> https://piku.github.io/get <span class=\"token operator\">|</span> <span class=\"token function\">sh</span>\r\n./piku-bootstrap <span class=\"token function\">install</span></code></pre></div>\n<h3 id=\"configure-ssh\" style=\"position:relative;\"><a href=\"#configure-ssh\" aria-label=\"configure ssh permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Configure SSH</h3>\n<p>After generating your private key via the <code class=\"language-text\">ssh-keygen</code> (name the file id_rsa in the C:/Users/username/.ssh directory) command\r\nif you open the private key and it says OPEN-SSH instead of RSA you need to convert it via this command.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">ssh-keygen -p -m PEM -f ~/.ssh/id_rsa</code></pre></div>\n<p>SSH to your VPS and create a file in /tmp called id_rsa.pub <code class=\"language-text\">touch /tmp/id_rsa.pub</code> Take the id_rsa.pub and put it in there\r\ncan <code class=\"language-text\">nano</code> into the file <code class=\"language-text\">Shift-ins</code> to paste. To select all and delete in case your public key is messed up <code class=\"language-text\">Ctrl+A Ctrl+K</code> will delete\r\neverything in the file. <code class=\"language-text\">Ctrl+X</code> to quit <code class=\"language-text\">Y</code> to save <code class=\"language-text\">N</code> to discard changes.</p>\n<p>Then run these commands</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">su</span> - piku\r\npython3 piku.py setup:ssh /tmp/id_rsa.pub</code></pre></div>\n<h3 id=\"configure-domain-records\" style=\"position:relative;\"><a href=\"#configure-domain-records\" aria-label=\"configure domain records permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Configure Domain Records</h3>\n<p>A Record</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">Hostname: @ or blank\r\nType: A\r\nTTL: <span class=\"token number\">3600</span>\r\nData: myserverip</code></pre></div>\n<p>CNAME Record</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">Hostname: www\r\nType: CNAME\r\nTTL: <span class=\"token number\">3600</span>\r\nData: myserverip</code></pre></div>\n<h3 id=\"additional-project-files\" style=\"position:relative;\"><a href=\"#additional-project-files\" aria-label=\"additional project files permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Additional Project Files</h3>\n<p>These are files that will be added to the root of your web application or service.</p>\n<p>ENV</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token assign-left variable\">NGINX_SERVER_NAME</span><span class=\"token operator\">=</span>domain.com\r\n<span class=\"token assign-left variable\">NGINX_HTTPS_ONLY</span><span class=\"token operator\">=</span><span class=\"token number\">1</span>\r\n<span class=\"token assign-left variable\">NODE_VERSION</span><span class=\"token operator\">=</span><span class=\"token number\">16.14</span>.0</code></pre></div>\n<p>Procfile</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">web: <span class=\"token function\">node</span> server.js</code></pre></div>\n<p>server.js</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"path\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> express <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"express\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token function\">express</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// create express app</span>\r\n\r\napp<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  res<span class=\"token punctuation\">.</span><span class=\"token function\">sendFile</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">\"build\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"index.html\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token comment\">// start express server on port 5000</span>\r\n<span class=\"token keyword\">var</span> port <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">[</span><span class=\"token string\">\"PORT\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">||</span> <span class=\"token number\">8000</span><span class=\"token punctuation\">;</span>\r\napp<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span>port<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"server started on port\"</span><span class=\"token punctuation\">,</span> port<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"publishing\" style=\"position:relative;\"><a href=\"#publishing\" aria-label=\"publishing permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Publishing</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> remote <span class=\"token function\">add</span> piku piku@myserverip:myappname\r\n<span class=\"token function\">git</span> push piku main</code></pre></div>\n<h3 id=\"troubleshooting\" style=\"position:relative;\"><a href=\"#troubleshooting\" aria-label=\"troubleshooting permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Troubleshooting</h3>\n<p>if you have trouble provisioning a certificate with a timeout error ensure the firewall rules are allowing traffic to port 80</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> ufw allow <span class=\"token number\">80</span>/tcp</code></pre></div>\n<p>if you have everything set up but cannot see your deployed application on your custom domain allow nginx port 80 and 443 through the firewall</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> ufw allow <span class=\"token string\">\"Nginx FULL\"</span></code></pre></div>\n<h3 id=\"useful-commands\" style=\"position:relative;\"><a href=\"#useful-commands\" aria-label=\"useful commands permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Useful commands</h3>\n<p>To find the files actually under the hood that Piku uses (Nginx configs etc)</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">ls</span> /home/piku/.piku\r\n\r\nacme  apps  envs  logs  nginx  repos  uwsgi  uwsgi-available  uwsgi-enabled</code></pre></div>\n<p>SSH Commands</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">ssh</span> piku@myserverip\r\n\r\nCommands:\r\n  apps              List apps, e.g.: piku apps\r\n  config            Show config, e.g.: piku config <span class=\"token operator\">&lt;</span>app<span class=\"token operator\">></span>\r\n  config:get        e.g.: piku config:get <span class=\"token operator\">&lt;</span>app<span class=\"token operator\">></span> FOO\r\n  config:live       e.g.: piku config:live <span class=\"token operator\">&lt;</span>app<span class=\"token operator\">></span>\r\n  config:set        e.g.: piku config:set <span class=\"token operator\">&lt;</span>app<span class=\"token operator\">></span> <span class=\"token assign-left variable\">FOO</span><span class=\"token operator\">=</span>bar <span class=\"token assign-left variable\">BAZ</span><span class=\"token operator\">=</span>quux\r\n  config:unset      e.g.: piku config:unset <span class=\"token operator\">&lt;</span>app<span class=\"token operator\">></span> FOO\r\n  deploy            e.g.: piku deploy <span class=\"token operator\">&lt;</span>app<span class=\"token operator\">></span>\r\n  destroy           e.g.: piku destroy <span class=\"token operator\">&lt;</span>app<span class=\"token operator\">></span>\r\n  git-hook          INTERNAL: Post-receive <span class=\"token function\">git</span> hook\r\n  git-receive-pack  INTERNAL: Handle <span class=\"token function\">git</span> pushes <span class=\"token keyword\">for</span> an app\r\n  git-upload-pack   INTERNAL: Handle <span class=\"token function\">git</span> upload pack <span class=\"token keyword\">for</span> an app\r\n  <span class=\"token builtin class-name\">help</span>              display <span class=\"token builtin class-name\">help</span> <span class=\"token keyword\">for</span> piku\r\n  logs              Tail running logs, e.g: piku logs <span class=\"token operator\">&lt;</span>app<span class=\"token operator\">></span> <span class=\"token punctuation\">[</span><span class=\"token operator\">&lt;</span>process<span class=\"token operator\">></span><span class=\"token punctuation\">]</span>\r\n  <span class=\"token function\">ps</span>                Show process count, e.g: piku <span class=\"token function\">ps</span> <span class=\"token operator\">&lt;</span>app<span class=\"token operator\">></span>\r\n  ps:scale          e.g.: piku ps:scale <span class=\"token operator\">&lt;</span>app<span class=\"token operator\">></span> <span class=\"token operator\">&lt;</span>proc<span class=\"token operator\">>=</span><span class=\"token operator\">&lt;</span>count<span class=\"token operator\">></span>\r\n  restart           Restart an app: piku restart <span class=\"token operator\">&lt;</span>app<span class=\"token operator\">></span>\r\n  run               e.g.: piku run <span class=\"token operator\">&lt;</span>app<span class=\"token operator\">></span> <span class=\"token function\">ls</span> -- -al\r\n  setup             Initialize environment\r\n  setup:ssh         Set up a new SSH key <span class=\"token punctuation\">(</span>use - <span class=\"token keyword\">for</span> stdin<span class=\"token punctuation\">)</span>\r\n  stop              Stop an app, e.g: piku stop <span class=\"token operator\">&lt;</span>app<span class=\"token operator\">></span>\r\n  update            Update the piku cli\r\n</code></pre></div>","fields":{"slug":"/posts/2022-06-2---Piku/piku","tagSlugs":["/tag/deployment/","/tag/heroku/"]},"frontmatter":{"date":"2022-06-02","description":"Piku cheatsheet to get up and running quickly","tags":["Deployment","Heroku"],"title":"Piku Explained","socialImage":"/media/notebook.jpg"}}},"pageContext":{"slug":"/posts/2022-06-2---Piku/piku"}},"staticQueryHashes":["251939775","357378587","401334301"]}